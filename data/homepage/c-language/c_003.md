# C语言控制流与函数

目标：掌握选择与循环语句、函数声明与定义、作用域与链接、头文件组织与编译单元。

## 1. 控制流
- 条件：if (cond) {} else {}；switch (expr) {case val: ... break; default: ...}
  - switch限制：expr须整数类型；case标签常量；fall-through需注意。
- 循环：for (init; cond; incr) {}；while (cond) {}；do {} while (cond);
  - 控制：break退出循环；continue跳过本次迭代；goto label;（慎用）。
- 陷阱：无限循环、忘记break in switch、循环变量作用域 (C99 for)。

## 2. 函数
- 声明：void func(int param); 原型提供类型检查。
- 定义：void func(int param) { ... } 值传递：修改param不影响调用者。
- 作用域：参数块作用域；局部变量自动存储期。
- 变参：#include <stdarg.h>；va_list, va_start, va_arg, va_end。
- 递归：函数调用自身；注意栈溢出，尾递归优化依赖编译器。
- 内联 (C99)：inline void fast_func() {} 建议内联但非强制。

示例：
```c
#include <stdio.h>

int add(int a, int b) { return a + b; }

int main(void) {
    int s = add(2, 3);
    printf("%d\n", s);
    return 0;
}
```

## 3. 存储期与链接
- 存储期：自动 (块结束销毁)、静态 (程序生命周期)、分配 (malloc)。
- 链接：extern (外部链接，可多文件共享)；static (内部链接，文件内)。
- 线程本地 (C11)：_Thread_local int var; 每个线程独立。

## 4. 头文件与编译单元
- 头文件：.h 放声明、宏；使用 #ifndef GUARD #define GUARD ... #endif 保护。
- 编译单元：每个.c 文件独立编译，链接成可执行。
- 示例：多文件项目 - main.c 调用 lib.c 函数，通过 lib.h 声明。

## 5. 示例
示例A：递归阶乘与尾递归优化讨论
```c
unsigned fact(unsigned n) { return n<2 ? 1 : n * fact(n-1); }
```

示例B：变参函数求和
```c
#include <stdarg.h>
int sum(int n, ...) {
    va_list ap; va_start(ap, n);
    int s=0; for(int i=0; i<n; i++) s += va_arg(ap, int);
    va_end(ap); return s;
}
```

## 6. 练习
- 实现非递归斐波那契使用循环。
- 写变参函数打印任意类型参数（需类型标签）。
- 设计多文件程序：分离计算与主逻辑。

## 更多练习参考答案
- 斐波那契：使用两个变量迭代，避免栈开销。
- 变参打印：switch on 类型标签，va_arg相应类型。
- 多文件：头文件声明函数，源文件定义，main链接使用。

## 参考资料
- C 接口与实现组织建议：以头文件暴露API、隐藏实现细节。
- CMake 多文件构建示例（官方教程章节 2-4）。