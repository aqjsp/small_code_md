# 输入输出与文件：与外界交互

目标：深入理解printf/scanf系列函数、文件流操作、缓冲与刷新、二进制与文本模式、错误处理。

## 1. 标准输入输出
- printf族：printf/sprintf/snprintf/fprintf；格式说明符与转换说明
- scanf族：scanf/sscanf/fscanf；输入缓冲与回车残留问题
- 字符与行：getchar/putchar、fgets/fputs（推荐）vs gets/puts（不安全）

格式说明符示例：
- %d/%i（int）、%u（unsigned）、%ld（long）、%zu（size_t）
- %f/%g（float/double）、%e（科学计数法）
- %c（char）、%s（字符串）、%p（指针）
- %x/%X（十六进制）、%o（八进制）

## 2. 文件操作
- 打开与关闭：fopen/fclose；模式字符串："r", "w", "a", "rb", "w+", "a+" 等
- 位置操作：fseek/ftell/rewind；二进制模式避免换行符转换问题
- 读写操作：fread/fwrite（二进制）、fgetc/fputc（字符）、fgets/fputs（行）

示例：
```c
#include <stdio.h>

int main(void) {
    FILE *fp = fopen("test.txt", "w");
    if (!fp) {
        perror("fopen");
        return 1;
    }
    fprintf(fp, "Hello, File!\n");
    fclose(fp);
    
    fp = fopen("test.txt", "r");
    if (!fp) return 1;
    char buffer[100];
    if (fgets(buffer, sizeof buffer, fp)) {
        printf("读取到：%s", buffer);
    }
    fclose(fp);
    return 0;
}
```

## 3. 缓冲与错误处理
- 缓冲类型：全缓冲、行缓冲、无缓冲；fflush显式刷新
- 错误检测：feof/ferror/clearerr；perror打印系统错误信息
- 临时文件：tmpfile/tmpnam（安全性考虑，现代建议mkstemp等）

## 4. 练习
- 写一个函数统计文件中的字符数、行数、单词数。
- 实现二进制文件的简单读写：将整数数组写入文件，再读回。
- 处理scanf的输入缓冲问题：连续读取整数与字符串时的清理。

## 更多示例

示例A：scanf缓冲问题与解决
```c
#include <stdio.h>
int main(void){
    int n; char s[32];
    scanf("%d", &n);
    // 消耗遗留的换行符
    int ch; while((ch=getchar())!='\n' && ch!=EOF){}
    fgets(s, sizeof s, stdin); // 读取一行字符串
    printf("n=%d, s=%s", n, s);
}
```

示例B：二进制读写
```c
#include <stdio.h>
int main(void){
    FILE *fp = fopen("arr.bin","wb");
    int a[3]={1,2,3}; fwrite(a,sizeof a[0],3,fp); fclose(fp);
    fp = fopen("arr.bin","rb");
    int b[3]; fread(b,sizeof b[0],3,fp); fclose(fp);
    printf("%d %d %d\n", b[0], b[1], b[2]);
}
```

## 练习参考答案（节选）
- 统计字符/行/单词数：以fgets读取行，用isspace分词，注意最后一行是否以换行结束。
- 处理文本/二进制差异：在Windows用"rb"/"wb"避免换行转换。

## 参考资料
- C11 标准 I/O 章节；POSIX关于文本模式与二进制的说明（平台相关差异）。