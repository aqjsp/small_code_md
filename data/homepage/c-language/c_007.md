# C语言预处理器与宏

目标：掌握头文件包含、宏定义、函数式宏、条件编译、内置宏与常见陷阱；理解宏与内联、枚举常量等替代方案。

## 1. 头文件包含
- #include <stdio.h> vs "my.h"；多重包含防护 #ifndef MY_H #define MY_H ... #endif

## 2. 宏定义
- 简单：#define PI 3.14
- 带参：#define MAX(a,b) ((a)>(b)?(a):(b)) 注意括号避免优先级问题
- 字符串化 # 与连接 ##
- 可变参数 (C99) #define ERR(...) fprintf(stderr, __VA_ARGS__)

## 3. 条件编译
- #if/#ifdef/#ifndef/#elif/#else/#endif
- defined(XXX) 检查宏定义
- 用于调试、平台适配

## 4. 内置宏
- __FILE__/__LINE__/__func__ (C99)
- __DATE__/__TIME__/__STDC__

## 5. 常见陷阱与替代
- 陷阱：副作用如 MAX(x++,y)；未定义顺序
- 替代：const double PI=3.14; inline int max(int a,int b){return a>b?a:b;}

## 6. 示例
示例A：多重包含防护
```c
#ifndef MY_H
#define MY_H
// 内容
#endif
```

示例B：可变宏
```c
#define LOG(fmt, ...) printf("[%s:%d] " fmt "\n", __FILE__, __LINE__, __VA_ARGS__)
```

## 7. 练习
- 写宏交换两个变量无临时。
- 条件编译平台特定代码。
- 实现泛型max使用 _Generic (C11)。

## 更多练习参考答案
- 交换：#define SWAP(a,b) do{ typeof(a) t=a; a=b; b=t; }while(0)
- 平台：#ifdef _WIN32 // windows code #else // others #endif
- _Generic：#define MAX(a,b) _Generic((a), int: imax, double: dmax, default: smax)(a,b)